<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Global Plane Crashes ‚úàÔ∏é (1908 ‚Äì 2023)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    :root { --fg:#111; --muted:#444; --bg:#e6f2ff; }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      margin:0; padding:24px; color:var(--fg); background:var(--bg); line-height:1.6;
    }
    header, .viz-wrap, .footer { max-width:1100px; margin:0 auto; }
    header { margin-bottom:16px; text-align:center; }
    h1 {
      margin:0 0 8px 0;
      font-size:48px; font-weight:800; letter-spacing:1px; text-transform:uppercase;
      color:#0a2740; text-shadow:1px 2px 6px rgba(0,0,0,0.15);
    }
    h2 { margin:0 0 12px 0; font-size:22px; }
    p { margin:8px 0; color:var(--muted); }

    /* --- Flip Cards --- */
    .infographic-row {
      display:flex; justify-content:space-between; gap:16px;
      margin:28px 0 32px 0;
    }
    .flip-card { width:33%; height:220px; perspective:1000px; }
    .flip-inner {
      position:relative; width:100%; height:100%;
      transition:transform .8s; transform-style:preserve-3d;
    }
    .flip-card:hover .flip-inner { transform:rotateY(180deg); }
    .flip-front, .flip-back {
      position:absolute; inset:0;
      border-radius:14px; border:2px solid #ccc; box-shadow:0 2px 8px rgba(0,0,0,.05);
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      padding:20px; text-align:center; font-weight:600;
      -webkit-backface-visibility:hidden; backface-visibility:hidden;
    }
    .flip-front { background:#fff; color:#333; font-size:18px; }
    .flip-front span { font-size:36px; margin-bottom:10px; }
    .flip-front small { color:#777; font-size:13px; margin-top:8px; }
    .flip-back { background:#1f77b4; color:#fff; transform:rotateY(180deg); font-size:14px; line-height:1.4; }

    .panel {
      background:#fff; border-radius:14px; border:1px solid #eee;
      box-shadow:0 4px 18px rgba(0,0,0,.07);
      padding:16px; margin:16px auto;
    }

    .charts {
      display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); gap:16px;
    }
    .chart { min-width:0; width:100%; }
    @media (max-width:900px){
      .charts { grid-template-columns:1fr; }
      .infographic-row { flex-direction:column; }
      .flip-card { width:100%; }
    }

    .error { color:#b00020; white-space:pre-wrap; margin-top:12px; display:none; }
  </style>
</head>
<body>
  <header>
    <h1>Global Plane Crashes ‚úàÔ∏é (1908 ‚Äì 2023)</h1>
    <p>Visualising over a century of aviation incidents worldwide.</p>

    <!-- Flip Cards -->
    <div class="infographic-row">
      <div class="flip-card">
        <div class="flip-inner">
          <div class="flip-front">
            <span>‚úàÔ∏è</span>
            Tenerife Airport Disaster
            <small>(Hover me)</small>
          </div>
          <div class="flip-back">
            <div>
              <strong>Year:</strong> 1977<br>
              <strong>Operator:</strong> KLM & Pan Am<br>
              <strong>Aboard:</strong> 644<br>
              <strong>Deaths:</strong> 583<br>
              <em>Two Boeing 747s collided in fog at Tenerife ‚Äî the deadliest crash in history.</em>
            </div>
          </div>
        </div>
      </div>
      <div class="flip-card">
        <div class="flip-inner">
          <div class="flip-front">
            <span>üõ´</span>
            Japan Airlines Flight 123
            <small>(Hover me)</small>
          </div>
          <div class="flip-back">
            <div>
              <strong>Year:</strong> 1985<br>
              <strong>Operator:</strong> Japan Airlines<br>
              <strong>Aboard:</strong> 524<br>
              <strong>Deaths:</strong> 520<br>
              <em>Decompression led to loss of control and crash into mountainous terrain.</em>
            </div>
          </div>
        </div>
      </div>
      <div class="flip-card">
        <div class="flip-inner">
          <div class="flip-front">
            <span>üõ©Ô∏è</span>
            Charkhi Dadri Collision
            <small>(Hover me)</small>
          </div>
          <div class="flip-back">
            <div>
              <strong>Year:</strong> 1996<br>
              <strong>Operator:</strong> Saudi Arabian & Kazakhstan Airlines<br>
              <strong>Aboard:</strong> 349<br>
              <strong>Deaths:</strong> 349<br>
              <em>Two jets collided near New Delhi ‚Äî one of the worst mid-air disasters.</em>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- MAP -->
  <div class="viz-wrap panel">
    <h2>Crash Locations & Fatalities (Map)</h2>
    <div id="crash_map" class="chart"></div>
    <div id="map_err" class="error"></div>
  </div>

  <!-- LINE + SCATTER -->
  <div class="viz-wrap panel">
    <h2>Fatalities & Crash Numbers Over Time ‚Ä¢ Aboard vs Fatalities</h2>
    <div class="charts">
      <div id="line_chart" class="chart"></div>
      <div id="scatter_chart" class="chart"></div>
    </div>
  </div>

  <!-- HEATMAP + OPERATORS -->
  <div class="viz-wrap panel">
    <h2>Crash Frequency by Month √ó Decade ‚Ä¢ Top Operators</h2>
    <div class="charts">
      <div id="heatmap" class="chart"></div>
      <div>
        <div id="operator_hist" class="chart"></div>
        <div id="operator_err" class="error"></div>
      </div>
    </div>
  </div>

  <div class="footer" style="margin-top:24px;">
    <p>Data: <code>Plane_Crashes_Final.csv</code> | Built with Vega-Lite</p>
  </div>

  <script>
    /* ---------- MAP ---------- */
    function mapSpec(widthPx){
      return {
        "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
        "autosize":{"type":"fit","contains":"padding"},
        "width":widthPx,"height":560,
        "projection":{"type":"equalEarth"},
        "params":[{"name":"yearSel","value":1950,
          "bind":{"input":"range","min":1908,"max":2023,"step":1,"name":"Year: "}}],
        "layer":[
          {
            "data":{"url":"https://cdn.jsdelivr.net/npm/vega-datasets@2.0.0/data/world-110m.json",
                    "format":{"type":"topojson","feature":"countries"}},
            "mark":{"type":"geoshape","fill":"#e6e6e6","stroke":"white"}
          },
          {
            "data":{"url":"Plane_Crashes_Final.csv","format":{"type":"csv"}},
            "transform":[
              {"calculate":"year(timeParse(datum.Date,'%m/%d/%Y'))","as":"Year"},
              {"calculate":"isValid(datum.Latitude)? trim(datum.Latitude): ''","as":"_latRaw"},
              {"calculate":"isValid(datum.Longitude)? trim(datum.Longitude): ''","as":"_lonRaw"},
              {"calculate":"test(/s/i, datum._latRaw)?-1:1","as":"_latSign"},
              {"calculate":"test(/w/i, datum._lonRaw)?-1:1","as":"_lonSign"},
              {"calculate":"toNumber(replace(datum._latRaw,/[^0-9.\\-]/g,''))","as":"_latNum"},
              {"calculate":"toNumber(replace(datum._lonRaw,/[^0-9.\\-]/g,''))","as":"_lonNum"},
              {"calculate":"datum._latSign*datum._latNum","as":"lat"},
              {"calculate":"datum._lonSign*datum._lonNum","as":"lon"},
              {"filter":"datum.Year==yearSel"},
              {"filter":"isFinite(datum.lat)&&isFinite(datum.lon)"}
            ],
            "mark":{"type":"circle","opacity":0.7},
            "encoding":{
              "longitude":{"field":"lon","type":"quantitative"},
              "latitude":{"field":"lat","type":"quantitative"},
              "size":{"field":"Fatalities","type":"quantitative","scale":{"range":[12,900]}},
              "color":{"field":"Fatalities","type":"quantitative","scale":{"scheme":"reds"}},
              "tooltip":[{"field":"Date"},{"field":"Location"},{"field":"Operator"},
                         {"field":"Fatalities"},{"field":"Aboard"}]
            }
          }
        ]
      };
    }

    /* ---------- LINE: Fatalities + Crashes ---------- */
    const specLine={
      "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
      "width":"container","height":320,
      "config":{"axis":{"labelColor":"black","titleColor":"black"},"view":{"stroke":"transparent"}},
      "data":{"url":"Plane_Crashes_Final.csv","format":{"type":"csv"}},
      "transform":[
        {"calculate":"year(timeParse(datum.Date,'%m/%d/%Y'))","as":"Year"},
        {"filter":"isValid(datum.Year)"}
      ],
      "resolve":{"scale":{"y":"independent"}},
      "layer":[
        {"transform":[{"aggregate":[{"op":"sum","field":"Fatalities","as":"Fatalities"}],"groupby":["Year"]}],
         "mark":{"type":"line","point":true,"strokeWidth":2,"color":"#d62728"},
         "encoding":{"x":{"field":"Year","type":"quantitative","title":"Year"},
                     "y":{"field":"Fatalities","type":"quantitative","axis":{"title":"Fatalities"}}}},
        {"transform":[{"aggregate":[{"op":"count","as":"Crashes"}],"groupby":["Year"]}],
         "mark":{"type":"line","point":true,"strokeWidth":2,"color":"#1f77b4"},
         "encoding":{"x":{"field":"Year","type":"quantitative"},
                     "y":{"field":"Crashes","type":"quantitative","axis":{"title":"Crashes","orient":"right"}}}}
      ]
    };

    /* ---------- SCATTER: Aboard vs Fatalities ---------- */
    const specScatter={
      "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
      "width":"container","height":320,
      "config":{"axis":{"labelColor":"black","titleColor":"black"},"view":{"stroke":"transparent"}},
      "data":{"url":"Plane_Crashes_Final.csv","format":{"type":"csv"}},
      "transform":[{"filter":"isValid(datum.Aboard)&&isValid(datum.Fatalities)"}],
      "layer":[
        {"mark":{"type":"line","strokeDash":[4,4],"opacity":0.7},
         "data":{"values":[{"x":0,"y":0},{"x":650,"y":650}]},
         "encoding":{"x":{"field":"x","type":"quantitative","title":"Aboard","scale":{"domain":[0,650]}},
                     "y":{"field":"y","type":"quantitative","title":"Fatalities","scale":{"domain":[0,650]}}}},
        {"mark":{"type":"point","filled":true,"opacity":0.6,"color":"#1f77b4"},
         "encoding":{"x":{"field":"Aboard","type":"quantitative","title":"Aboard","scale":{"domain":[0,650]}},
                     "y":{"field":"Fatalities","type":"quantitative","title":"Fatalities","scale":{"domain":[0,650]}},
                     "tooltip":[{"field":"Date"},{"field":"Operator"},{"field":"Aboard"},{"field":"Fatalities"}]}}
      ]
    };

    /* ---------- HEATMAP: Month √ó Decade ---------- */
    const specHeatmap={
      "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
      "width":"container","height":420,
      "data":{"url":"Plane_Crashes_Final.csv","format":{"type":"csv"}},
      "transform":[
        {"calculate":"year(timeParse(datum.Date,'%m/%d/%Y'))","as":"Year"},
        {"calculate":"month(timeParse(datum.Date,'%m/%d/%Y'))","as":"MonthIndex"},
        {"calculate":"floor(datum.Year/10)*10","as":"Decade"},
        {"aggregate":[{"op":"count","as":"Crashes"}],"groupby":["Decade","MonthIndex"]},
        {"calculate":"toString(datum.Decade)+'s'","as":"DecadeLabel"},
        {"calculate":"['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][datum.MonthIndex]","as":"MonthName"}
      ],
      "mark":{"type":"rect"},
      "encoding":{
        "x":{"field":"MonthName","type":"ordinal","title":"Month",
             "sort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},
        "y":{"field":"DecadeLabel","type":"ordinal","title":"Decade",
             "sort":{"field":"Decade","order":"ascending"}},
        "color":{"field":"Crashes","type":"quantitative","title":"Crashes","scale":{"scheme":"reds"}},
        "tooltip":[{"field":"DecadeLabel"},{"field":"MonthName"},{"field":"Crashes"}]
      }
    };

    /* ---------- OPERATORS: Top 20 ---------- */
    const specOperator={
      "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
      "width":"container","height":420,
      "data":{"url":"Plane_Crashes_Final.csv","format":{"type":"csv"}},
      "transform":[
        {"filter":"isValid(datum.Operator)"},
        {"aggregate":[{"op":"count","as":"Crashes"}],"groupby":["Operator"]},
        {"window":[{"op":"rank","as":"rank"}],"sort":[{"field":"Crashes","order":"descending"}]},
        {"filter":"datum.rank <= 20"}
      ],
      "mark":{"type":"bar"},
      "encoding":{
        "y":{"field":"Operator","type":"ordinal","title":"Operator","sort":"-x",
             "axis":{"labelLimit":200,
                     "labelExpr":"length(datum.label)>28?slice(datum.label,0,25)+'‚Ä¶':datum.label"}},
        "x":{"field":"Crashes","type":"quantitative","title":"Crashes"},
        "color":{"value":"#1f77b4"},
        "tooltip":[{"field":"Operator"},{"field":"Crashes"}]
      }
    };

    /* ---------- Render All ---------- */
    function renderAll(){
      const mapEl=document.getElementById('crash_map');
      const mapWidth=Math.max(700, mapEl.clientWidth || 700); // keeps map comfy in panel
      vegaEmbed('#crash_map', mapSpec(mapWidth), {actions:{export:true,source:true,editor:true}})
        .catch(err => { const el=document.getElementById('map_err'); el.style.display='block'; el.textContent=String(err); });

      vegaEmbed('#line_chart',   specLine,    {actions:{export:true,source:true,editor:true}});
      vegaEmbed('#scatter_chart',specScatter, {actions:{export:true,source:true,editor:true}});
      vegaEmbed('#heatmap',      specHeatmap, {actions:{export:true,source:true,editor:true}});
      vegaEmbed('#operator_hist',specOperator,{actions:{export:true,source:true,editor:true}})
        .catch(err => { const el=document.getElementById('operator_err'); el.style.display='block'; el.textContent=String(err); });
    }
    renderAll();
    window.addEventListener('resize', renderAll);
  </script>
</body>
</html>
