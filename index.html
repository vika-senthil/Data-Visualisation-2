<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Global Plane Crashes ✈︎ (1908 – 2023)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Vega libs -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    :root { --fg:#111; --muted:#555; --bg:#fafafa; }
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
           margin:0; padding:24px; color:var(--fg); background:var(--bg); line-height:1.6; }
    header, .viz-wrap, .footer { max-width:1100px; margin:0 auto; }
    header { margin-bottom:16px; text-align:center; }
    h1 { margin:0 0 8px 0; font-size:30px; }
    h2 { margin:0 0 8px 0; font-size:22px; }
    p { margin:8px 0; color:var(--muted); }

    .panel { background:#fff; border-radius:14px; box-shadow:0 4px 18px rgba(0,0,0,.07);
      padding:16px; border:1px solid #eee; margin:16px auto; }

    /* Robust, no-overflow two-column layout */
    .charts {
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:16px;
    }
    .chart {
      min-width:0; /* <- prevents overflow of SVG inside grid cell */
    }

    /* Stack on narrow screens */
    @media (max-width: 900px) {
      .charts { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Global Plane Crashes ✈︎ (1908 – 2023)</h1>
    <p>Visualising over a century of aviation incidents.</p>
  </header>

  <!-- MAP -->
  <div class="viz-wrap panel">
    <h2>Crash Locations & Fatalities (Map)</h2>
    <div id="crash_map" class="chart"></div>
  </div>

  <!-- LINE + SCATTER (rendered separately; no hconcat) -->
  <div class="viz-wrap panel">
    <h2>Fatalities & Crash Numbers Over Time • Aboard vs Fatalities</h2>
    <div class="charts">
      <div id="line_chart" class="chart"></div>
      <div id="scatter_chart" class="chart"></div>
    </div>
  </div>

  <div class="footer" style="margin-top:24px;">
    <p>Data: <code>Plane_Crashes_Final.csv</code> | Built with Vega-Lite</p>
  </div>

  <script>
    /* ================= MAP (responsive) ================= */
    const specMap = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": "container", "height": 560,
      "projection": {"type": "equalEarth"},
      "layer": [
        {
          "data": {
            "url": "https://cdn.jsdelivr.net/npm/vega-datasets@2.0.0/data/world-110m.json",
            "format": {"type": "topojson", "feature": "countries"}
          },
          "mark": {"type": "geoshape", "fill": "#e6e6e6", "stroke": "white"}
        },
        {
          "data": {"url": "Plane_Crashes_Final.csv","format":{"type":"csv"}},
          "transform": [
            {"calculate":"year(timeParse(datum.Date,'%m/%d/%Y'))","as":"Year"},
            {"filter":"isValid(datum.Latitude) && isValid(datum.Longitude)"}
          ],
          "mark":{"type":"circle","opacity":0.7},
          "encoding":{
            "longitude":{"field":"Longitude","type":"quantitative"},
            "latitude":{"field":"Latitude","type":"quantitative"},
            "size":{"field":"Fatalities","type":"quantitative","scale":{"range":[12,900]}},
            "color":{"field":"Fatalities","type":"quantitative","scale":{"scheme":"reds"}},
            "tooltip":[
              {"field":"Date","title":"Date"},
              {"field":"Location","title":"Location"},
              {"field":"Operator","title":"Operator"},
              {"field":"Fatalities","title":"Fatalities"},
              {"field":"Aboard","title":"Aboard"}
            ]
          }
        }
      ]
    };

    /* ================= LINE: Fatalities + Crash count ================= */
    const specLine = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": "container", "height": 320,
      "config": {"axis": {"labelColor":"black","titleColor":"black"}, "view":{"stroke":"transparent"}},
      "data": {"url": "Plane_Crashes_Final.csv","format":{"type":"csv"}},
      "transform": [
        {"calculate":"year(timeParse(datum.Date,'%m/%d/%Y'))","as":"Year"},
        {"filter":"isValid(datum.Year)"}
      ],
      "resolve": {"scale":{"y":"independent"}},
      "layer": [
        {
          "transform":[{"aggregate":[{"op":"sum","field":"Fatalities","as":"Fatalities"}],"groupby":["Year"]}],
          "mark":{"type":"line","point":true,"strokeWidth":2,"color":"#d62728"},
          "encoding":{
            "x":{"field":"Year","type":"quantitative","title":"Year"},
            "y":{"field":"Fatalities","type":"quantitative","axis":{"title":"Fatalities"}}
          }
        },
        {
          "transform":[{"aggregate":[{"op":"count","as":"Crashes"}],"groupby":["Year"]}],
          "mark":{"type":"line","point":true,"strokeWidth":2,"color":"#1f77b4"},
          "encoding":{
            "x":{"field":"Year","type":"quantitative"},
            "y":{"field":"Crashes","type":"quantitative","axis":{"title":"Crashes","orient":"right"}}
          }
        }
      ]
    };

    /* ================= SCATTER: Aboard vs Fatalities ================= */
    const specScatter = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": "container", "height": 320,
      "config": {"axis": {"labelColor":"black","titleColor":"black"}, "view":{"stroke":"transparent"}},
      "data": {"url": "Plane_Crashes_Final.csv","format":{"type":"csv"}},
      "transform": [{"filter":"isValid(datum.Aboard) && isValid(datum.Fatalities)"}],
      "layer": [
        {
          "mark":{"type":"line","strokeDash":[4,4],"opacity":0.7},
          "data":{"values":[{"x":0,"y":0},{"x":550,"y":550}]},
          "encoding":{
            "x":{"field":"x","type":"quantitative","title":"Aboard","scale":{"domain":[0,550]}},
            "y":{"field":"y","type":"quantitative","title":"Fatalities","scale":{"domain":[0,600]}}
          }
        },
        {
          "mark":{"type":"point","filled":true,"opacity":0.6,"color":"#1f77b4"},
          "encoding":{
            "x":{"field":"Aboard","type":"quantitative","title":"Aboard","scale":{"domain":[0,550]}},
            "y":{"field":"Fatalities","type":"quantitative","title":"Fatalities","scale":{"domain":[0,600]}},
            "tooltip":[
              {"field":"Date","title":"Date"},
              {"field":"Operator","title":"Operator"},
              {"field":"Aboard","title":"Aboard"},
              {"field":"Fatalities","title":"Fatalities"}
            ]
          }
        }
      ]
    };

    /* ============== Render ============== */
    vegaEmbed('#crash_map', specMap, {actions:{export:true,source:true,editor:true}});
    vegaEmbed('#line_chart', specLine, {actions:{export:true,source:true,editor:true}});
    vegaEmbed('#scatter_chart', specScatter, {actions:{export:true,source:true,editor:true}});
  </script>
</body>
</html>
